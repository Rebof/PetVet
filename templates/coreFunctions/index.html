{% extends 'main/base1.html' %}

{% load static %}


{% block content %}
    


        <!-- Main Contents -->
        <div class="main_content">
            <div class="mcontainer">

                <!--  Feeds  -->
                <div class="lg:flex lg:space-x-10">
                    <div class="lg:w-3/4 lg:px-20 space-y-7">


                        <!-- create post -->
                        <div class="card lg:mx-0 p-4" uk-toggle="target: #create-post-modal">
                            <div class="flex space-x-3">
                                <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" class="w-10 h-10 rounded-full">
                                <input placeholder="What's Your Mind ? {{ user.username }}" class="bg-gray-100 hover:bg-gray-200 flex-1 h-10 px-6 rounded-full">
                            </div>
                            <div class="grid grid-flow-col pt-3 -mx-1 -mb-1 font-semibold text-sm">
                                <div class="hover:bg-gray-100 flex items-center p-1.5 rounded-md cursor-pointer">
                                    <svg class="bg-blue-100 h-9 mr-2 p-1.5 rounded-full text-blue-600 w-9 -my-0.5 hidden lg:block" data-tippy-placement="top" title="Tooltip" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>                                    Photo/Video
                                </div>
                                <div class="hover:bg-gray-100 flex items-center p-1.5 rounded-md cursor-pointer">
                                </div>
                                <div class="hover:bg-gray-100 flex items-center p-1.5 rounded-md cursor-pointer">
                                    <svg class="bg-red-100 h-9 mr-2 p-1.5 rounded-full text-red-600 w-9 -my-0.5 hidden lg:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                                    Activity
                                </div>
                            </div>
                        </div>

                        


                        <!-- listng all the posts here -->
                        {% for post in posts %}
                        <div class="card lg:mx-0 uk-animation-slide-bottom-small">
                            <!-- Loop through posts -->
                            
                            <!-- Post header-->
                            <div class="flex justify-between items-center lg:p-4 p-2.5">
                                <div class="flex flex-1 items-center space-x-4">
                                    <a href="#">
                                        <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" class="bg-gray-200 border border-white rounded-full w-10 h-10">
                                    </a>
                                    <div class="flex-1 font-semibold capitalize">
                                        <a href="#" class="text-black dark:text-gray-100">{{ post.user.username }}</a>
                                        <div class="category">
                                            <strong>Category:</strong> {{ post.category.name }}
                                        </div>
                                        <div class="text-gray-700 flex items-center space-x-2">
                                            {% if "hour" in post.date|timesince %}
                                                {{ post.date|timesince|slice:":1" }}H ago
                                            {% elif "minute" in post.date|timesince %}
                                                0H ago
                                            {% else %}
                                                {{ post.date|timesince }} ago
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <a href="#">
                                        <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"></i>
                                    </a>
                                </div>
                            </div>
                        
                            <!-- Post content -->
                            <div uk-lightbox>
                                {% if post.image %}
                                <a href="{{ post.image.url }}">  
                                    <img src="{{ post.image.url }}" alt="{{ post.title }}" class="max-h-96 w-full object-cover">
                                </a>
                                {% endif %}
                            </div>
                        
                            <div class="p-4 space-y-3">
                                <h3 class="font-bold text-lg">{{ post.title }}</h3>

                                {% if post.body %}
                                <p class="text-gray-600 dark:text-gray-100">{{ post.body|linebreaks }}</p>
                                {% endif %}

                                <div class="flex space-x-4 lg:font-bold">
                                    <a style="cursor: pointer;" class="flex items-center space-x-2">
                                        <!-- like wala code -->                                        <!-- like wala code -->

                                        <div class="p-2 rounded-full like-btn{{post.id}} {% if request.user in post.likes.all %} text-blue-500 {% else %} text-black {% endif %}" id="like-btn" data-like-btn="{{post.id}}"> 
                                            <!-- Like icon datalikebtn is for server in the djago to grab the id -->
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100">
                                                <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/>
                                            </svg>
                                        </div>
                                        <div>Like</div>
                                    </a>
                                      
                                    <a href="#" class="flex items-center space-x-2">
                                        <div class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600">
                                            <!-- Comment icon -->
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100">
                                                <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div>Comment</div>
                                    </a>
                                    <div>
                                        likes: <span id="likes-count{{post.id}}">{{post.likes.all.count}}</span>
                                    </div>
                                    <div>
                                        comments: <span id="comments-count{{post.id}}">{{post.comment_set.all.count}}</span>
                                    </div>
                                </div>

                                <!-- comment section -->        <!-- comment section -->        <!-- comment section -->
                                <div class="border-t py-4 space-y-4 dark:border-gray-600" id="comment-div{{post.id}}">
                                    {% for comment in post.comment_set.all|slice:":3" %}
                                    <div class="flex card shadow p-2 mb-5" style="border-bottom: 2px solid red;"> <!-- Added bottom border for separation and spacing between comments -->
                                        <div>
                                            <!-- Comment Content -->
                                            <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                                                <p class="leading-6"> {{ comment.user.username }} </p>
                                                <p class="leading-6"> {{ comment.comment }} </p>
                                                <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"></div>
                                            </div>
                                            
                                            <!-- Like, Reply and Date Section -->
                                            <div class="text-xs flex items-center space-x-3 mt-2 ml-5">
                                                <a id="like-comment-btn" data-like-comment="{{comment.id}}" class="like-comment{{comment.id}}" {% if request.user in comment.likes.all %} style="color: red;" {% else %} style="color: gray;"  {% endif %}> 
                                                    <i style="cursor: pointer;" id="comment-icon{{comment.id}}" class="fas fa-heart"></i>
                                                </a> 
                                                <small><span class="" id="comment-likes-count{{comment.id}}">{{ comment.likes.all.count }}</span></small> 
                                                
                                                <!-- Reply Section -->
                                                <details>
                                                    <summary>
                                                        <div class="">Reply</div>
                                                    </summary>
                                                    <details-menu role="menu" class="origin-top-right relative right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none">
                                                        <div class="py-1" role="none">
                                                            <div class="p-1 d-flex">
                                                                <input type="text" class="with-border" name="" id="reply-input{{comment.id}}">
                                                                <button id="reply-comment-btn" data-reply-comment-btn="{{comment.id}}" type="submit" class="reply-comment-btn{{comment.id}} block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">
                                                                    <ion-icon name="send"></ion-icon>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </details-menu>
                                                </details>
                                
                                                <span> {{ comment.date|timesince }} ago </span>
                                            </div>
                                
                                            <!-- Reply Comment Section -->
                                            <div class="reply-div{{comment.id}} mt-4 space-y-4" style="border-left: 2px solid red; padding-left: 10px;"> <!-- Added a left border and spacing for replies -->
                                                {% for reply in comment.comment_replies %}
                                                <div class="flex mr-12" style="margin-right: 20px;">
                                                    <div>
                                                        <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                                                            <p class="leading-6">{{reply.user.username}}</p>
                                                            <p class="leading-6">{{reply.reply}}</p>
                                                            <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                

                                
                                {% if post.comment_set.all.count > 0 %}
                                    <a href="#" class="hover:text-blue-600 hover:underline">  View  more Comments </a>
                                {% endif %}
                                    

                                <!-- comment input section -->
                                <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t">
                                    <input placeholder="Add your Comment.." id="comment-input{{post.id}}" data-comment-input="{{post.id}}" class="bg-transparent max-h-10 shadow-none px-5">
                                </div>
                                <div>
                                    <a style="cursor: pointer;" id="comment-btn" class="comment-btn{{post.id}}" data-comment-btn="{{post.id}}">
                                        <ion-icon name="send-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                                    </a>
                                </div>
                            </div>
                            
                        </div>
                        {% endfor %}
                        

                        <div class="flex justify-center mt-6">
                            <a href="#" class="bg-white dark:bg-gray-900 font-semibold my-3 px-6 py-2 rounded-full shadow-md dark:bg-gray-800 dark:text-white">
                                Load more ..</a>
                        </div>

                    </div>
                    <div class="lg:w-72 w-full">

                        

                        <h3 class="text-xl font-semibold"> Something to fill it in </h3>

                        <div class="" uk-sticky="offset:80">


                            <div class="contact-list">

                                
                                

                               
                                


                            </div>


                        </div>

                    </div>
                </div>

            </div>
        </div>

    <!-- </div> -->



    <!-- open chat box -->
    <!-- <div uk-toggle="target: #offcanvas-chat" class="start-chat">
        <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
        </svg>
    </div>

    <div id="offcanvas-chat" uk-offcanvas="flip: true; overlay: true">
        <div class="uk-offcanvas-bar bg-white p-0 w-full lg:w-80 shadow-2xl">


            <div class="relative pt-5 px-4">

                <h3 class="text-2xl font-bold mb-2"> Chats </h3>

                <div class="absolute right-3 top-4 flex items-center space-x-2">

                    <button class="uk-offcanvas-close  px-2 -mt-1 relative rounded-full inset-0 lg:hidden blcok" type="button" uk-close></button>

                    <a href="#" uk-toggle="target: #search;animation: uk-animation-slide-top-small">
                        <ion-icon name="search" class="text-xl hover:bg-gray-100 p-1 rounded-full"></ion-icon>
                    </a>
                    <a href="#">
                        <ion-icon name="settings-outline" class="text-xl hover:bg-gray-100 p-1 rounded-full"></ion-icon>
                    </a>
                    <a href="#">
                        <ion-icon name="ellipsis-vertical" class="text-xl hover:bg-gray-100 p-1 rounded-full"></ion-icon>
                    </a>
                    <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700" uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small; offset:5">
                        <ul class="space-y-1">
                            <li>
                                <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                    <ion-icon name="checkbox-outline" class="pr-2 text-xl"></ion-icon> Mark all as read
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                    <ion-icon name="settings-outline" class="pr-2 text-xl"></ion-icon> Chat setting
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                    <ion-icon name="notifications-off-outline" class="pr-2 text-lg"></ion-icon> Disable notifications
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                    <ion-icon name="star-outline" class="pr-2 text-xl"></ion-icon> Create a group chat
                                </a>
                            </li>
                        </ul>
                    </div>


                </div> -->


            <!-- </div>

            <div class="absolute bg-white z-10 w-full -mt-5 lg:-mt-2 transform translate-y-1.5 py-2 border-b items-center flex" id="search" hidden>
                <input type="text" placeholder="Search.." class="flex-1">
                <ion-icon name="close-outline" class="text-2xl hover:bg-gray-100 p-1 rounded-full mr-4 cursor-pointer" uk-toggle="target: #search;animation: uk-animation-slide-top-small"></ion-icon>
            </div>

            <nav class="responsive-nav border-b extanded mb-2 -mt-2">
                <ul uk-switcher="connect: #chats-tab; animation: uk-animation-fade">
                    <li class="uk-active"><a class="active" href="#0"> Friends </a></li>
                    <li><a href="#0">Groups <span> 10 </span> </a></li>
                </ul>
            </nav> -->

            
                

    <!-- Craete post modal -->
    <div id="create-post-modal" class="create-post is-story" uk-modal>
        
        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical rounded-lg p-0 lg:w-5/12 relative shadow-2xl uk-animation-slide-bottom-small">
            
            <form method="post" id="post-form" enctype="multipart/form-data" action="{% url 'coreFunctions:create-post' %}">
            
            {% csrf_token %}
            <div class="text-center py-3 border-b">
                <h3 class="text-lg font-semibold"> Create Post </h3>
                <button class="uk-modal-close-default bg-gray-100 rounded-full p-2.5 right-2" type="button" uk-close uk-tooltip="title: Close ; pos: bottom ;offset:7"></button>
            </div>
    
            <div class="flex flex-1 items-start space-x-4 p-5">
                <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" class="bg-gray-200 border border-white rounded-full w-11 h-11">
                <div class="flex-1 pt-2">
                    <!-- Title Field -->
                    <div class="border-b pb-3 mb-4">
                        <input type="text" name="title" class="uk-input text-black shadow-none focus:shadow-none text-xl font-medium" placeholder="Title" />
                    </div>
                    <!-- Body Field -->
                    <div class="border-b pb-3">
                        <textarea class="uk-textarea text-black shadow-none focus:shadow-none text-xl font-medium resize-none" rows="5" name="body" placeholder="What's Your Mind? Stella!"></textarea>
                    </div>
                </div>
            </div>
    
            <div class="flex items-center w-full justify-between border-t p-3">
                <select class="selectpicker mt-2 story" name="category" id="category">
                    <option disabled selected>Select Category</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
    
            <!-- Preview Image Section -->
            <div class="flex flex-1 p-5 w-100">
                <div class="flex-1 pt-2">
                    <img src="https://joadre.com/wp-content/uploads/2019/02/no-image.jpg" id="preview_post_thumbnail" style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px;" alt="Preview" />
                </div>
            </div>
    
            <div class="absolute bottom-0 p-4 space-x-4 w-full">
                <div class="flex bg-gray-50 border border-purple-100 rounded-2xl p-2 shadow-sm items-center">
                    <div class="lg:block hidden ml-1"> Add to your post </div>
                    <div class="flex flex-1 items-center lg:justify-end justify-center space-x-2">
                        <svg class="bg-blue-100 h-9 p-1.5 rounded-full text-blue-600 w-9 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" onclick="document.getElementById('file-upload').click();">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
            
                        <!-- Hidden File Input for Images and Videos -->
                        <input id="file-upload" type="file" name="image" accept="image/*" class="hidden" onchange="handleFileUpload(event)" />
    
                        <!-- Add Post Button -->
                        <button class="uk-button uk-button-primary mt-2">Post</button>
                    </div>
                </div>
            </div>
            </form>
        </div>
    </div>
    
    <script>
        function handleFileUpload(event) {
            const file = event.target.files[0];
            const preview = document.getElementById("preview_post_thumbnail");
            const reader = new FileReader();
    
            reader.onload = function (e) {
                preview.src = e.target.result;
            };
    
            if (file) {
                reader.readAsDataURL(file); // Convert the file to base64
            }
        }
    </script>
    
    

{% endblock content %}